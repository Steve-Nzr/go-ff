apiVersion: serving.knative.dev/v1alpha1
kind: Service
metadata:
  name: go-ff-login
  namespace: default
spec:
  runLatest:
    configuration:
      # TODO(shikanime): create a BuildTemplate for Bazel
      # build:
      #   apiVersion: build.knative.dev/v1alpha1
      #   kind: Build
      #   spec:
      #     template:
      #       name: bazel
      #       arguments:
      #       - name: IMAGE
      #         value: login:latest
      #     timeout: 10m
      revisionTemplate:
        spec:
          container:
            image: login:latest
            imagePullPolicy: Always
            env:
            - name: POSTGRES_DB_ENDPOINT
              valueFrom:
                secretKeyRef:
                  name: postgres-credentials
                  key: endpoint
            - name: MYSQL_CACHE_ENDPOINT
              valueFrom:
                secretKeyRef:
                  name: mysql-credentials
                  key: endpoint
            - name: AMQP_ENDPOINT
              valueFrom:
                configMapKeyRef:
                  name: broker-config
                  key: endpoint
            - name: MESSAGE_EXPIRAITON
              valueFrom:
                configMapKeyRef:
                  name: broker-config
                  key: messageExpiration

